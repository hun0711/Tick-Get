<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="back.spring.final_back.board.repository.MarketDao">


<!-- 게시글 조회 및 조건검색 -->
<select id="mk_boardList" parameterType="MarketDto" resultType="MarketDto">
  select *
  from board_market
  <if test='condition!=null and condition.equals("전체")'>
    <choose>
      <when test='content=null and condition.equals("전체")'>
        WHERE board_mk_title LIKE CONCAT('%', #{content}, '%') 
      </when>
      <when test='content!=null and condition.equals("제목")'>
        WHERE board_mk_title LIKE CONCAT('%', #{content}, '%')  
      </when>
      <when test='content!=null and condition.equals("장소")'>
        WHERE mk_ticket_place LIKE CONCAT('%', #{content}, '%') 
      </when>
      <when test='content!=null and condition.equals("작성자")'>
        WHERE mem_name LIKE CONCAT('%', #{content}, '%') 
      </when>
    </choose>
  </if>
  <if test='condition!=null and !condition.equals("전체")'>
    <where>
      <if test='content!=null and condition.equals("제목")'>
        board_mk_title LIKE CONCAT('%', #{content}, '%') 
      </if>
      <if test='content!=null and condition.equals("장소")'>
        mk_ticket_place LIKE CONCAT('%', #{content}, '%') 
      </if>
      <if test='content!=null and condition.equals("작성자")'>
        mem_name LIKE CONCAT('%', #{content}, '%') 
      </if>
    </where>
  </if>
  order by board_mk_date DESC
</select>
<!-- 판매여부가 0인 (판매처리되지 않은) 게시글만 조회되게하기, board_mk_status -->








<!-- 게시글 입력 -->
<insert id="mk_boardInsert" parameterType="MarketDto">
insert into board_market (board_mk_title,board_mk_content,board_mk_date,board_mk_hit,

mk_ticket_place,mk_ticket_date,mk_ticket_seat,mk_ticket_count,mk_ticket_price,board_mk_filename,board_mk_fileurl,member_nickname,member_no,board_mk_status)
VALUES (#{boardMkTitle},#{boardMkContent},#{boardMkDate},#{boardMkHit},
#{mkTicketPlace}, #{mkTicketDate}, #{mkTicketSeat}, #{mkTicketCount}, #{mkTicketPrice},#{boardMkFilename},#{boardMkFileurl},#{memberNickname},#{memberNo},#{boardMkStatus})

</insert>





<!-- 게시글 수정 -->
<update id="mk_boardUpdate" parameterType="MarketDto">
 update board_market
 set 
     <if test='boardMkTitle!=null'>
     board_mk_title = #{boardMkTitle},
     </if>
     <if test='boardMkContent!=null'>
     board_mk_content = #{boardMkContent},
     </if>
     <if test='boardMkDate!=null'>
     board_mk_date = #{boardMkDate},
     </if>
      <if test='mkTicketPlace!=null'>
     mk_ticket_place = #{mkTicketPlace},
     </if>
      <if test='mkTicketDate!=null'>
     mk_ticket_date = #{mkTicketDate},
     </if>
      <if test='mkTicketSeat!=null'>
     mk_ticket_seat = #{mkTicketSeat},
     </if>
     <if test='mkTicketCount!=null'>
     mk_ticket_count = #{mkTicketCount},
     </if>
     <if test='mkTicketPrice!=null'>
     mk_ticket_price = #{mkTicketPrice},
     </if>
     <if test='boardMkFilename!=null'>
     board_mk_filename = #{boardMkFilename},
     </if>
     <if test='boardMkFileurl!=null'>
     board_mk_fileurl = #{boardMkFileurl},
     </if>
     WHERE board_mk_no = #{boardMkNo} 
</update>





<!-- 게시글 삭제 -->
<delete id="mk_boardDelete" parameterType="MarketDto">
delete from board_market
<where>
<if test='boardMkNo!=null and boardMkNo>0'>
board_mk_no = #{boardMkNo}
</if>
</where>
</delete>





<!-- 게시글 상세보기 -->
<select id="mk_boardDetail" parameterType="MarketDto" resultType="MarketDto">
select * from board_market 
<where>
  <if test='boardMkNo!=null'> <!-- setNull(1,1111)에러 타입, 부적합한 열 유형 Integer.parseInt() -->
    board_mk_no = #{boardMkNo}
    </if>
     </where>
</select>






<!-- 조회수 증가  -->	
	<update id="mk_boardHit" parameterType="MarketDto">
	<choose>
	<when test='boardMkNo!=null'>
	 UPDATE board_market SET board_mk_hit = board_mk_hit+1
	  WHERE board_mk_no = #{boardMkNo}
	</when>
	</choose>
	</update>
	
	
	<!-- 판매완료 처리 -->
<update id="mk_boardSell" parameterType="MarketDto">
<choose>
<when test='boardMkNo!=null'>
UPDATE board_market SET board_mk_status = board_mk_status + 1
 WHERE board_mk_no= #{boardMkNo}
</when>
</choose>
</update>


</mapper>